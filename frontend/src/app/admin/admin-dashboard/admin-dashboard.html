<div class="flex h-screen bg-gray-50 overflow-hidden">

    <!-- Sidebar -->
    <aside [class.w-64]="!sidebarCollapsed()" [class.w-20]="sidebarCollapsed()"
        class="bg-gradient-to-b from-slate-900 to-slate-800 text-white transition-all duration-300 flex flex-col shadow-2xl flex-shrink-0">

        <!-- Logo Header -->
        <div class="p-6 border-b border-slate-700">
            <div class="flex items-center justify-between">
                @if (!sidebarCollapsed()) {
                <div class="flex items-center space-x-3">
                    <div class="bg-cyan-400 p-2 rounded-lg">
                        <svg class="w-6 h-6 text-slate-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold">TOLEDO</h1>
                        <p class="text-xs text-cyan-400">Gestión Total</p>
                    </div>
                </div>
                }
                @else {
                <div class="bg-cyan-400 p-2 rounded-lg mx-auto">
                    <svg class="w-6 h-6 text-slate-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                </div>
                }
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="flex-1 py-6 px-3 space-y-2 overflow-y-auto">
            @for (item of menuItems; track item.id) {

            <!-- Menu item -->
            <button (click)="onMenuClick(item)" [class.bg-cyan-400]="currentTab() === item.id"
                [class.text-slate-900]="currentTab() === item.id" [class.shadow-lg]="currentTab() === item.id"
                [class.text-gray-300]="currentTab() !== item.id" [class.hover:bg-slate-700]="currentTab() !== item.id"
                [class.justify-center]="sidebarCollapsed()"
                class="w-full flex items-center space-x-3 px-4 py-3 rounded-xl transition-all duration-200 group relative">

                <svg class="w-5 h-5 flex-shrink-0" [class.text-slate-900]="currentTab() === item.id"
                    [class.text-gray-300]="currentTab() !== item.id" [class.group-hover:text-cyan-400]="currentTab() !== item.id"
                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="item.icon" />
                </svg>

                @if (!sidebarCollapsed()) {
                <span class="font-semibold flex-1 text-left">{{ item.label }}</span>

                @if (item.subItems) {
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    [class.rotate-90]="expandedGroup() === item.id">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
                }

                @if (!item.subItems && item.badge) {
                <span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">{{ item.badge }}</span>
                }
                }

                @else {
                @if (item.badge) {
                <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center">{{ item.badge }}</span>
                }
                }

                <!-- Tooltip when collapsed -->
                @if (sidebarCollapsed()) {
                <div class="absolute left-full ml-6 px-3 py-2 bg-slate-800 text-white text-sm rounded-lg shadow-xl opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap z-50">
                    {{ item.label }}
                    @if (item.badge) {
                    <span class="ml-2 bg-red-500 px-2 py-0.5 rounded-full text-xs">{{ item.badge }}</span>
                    }
                </div>
                }

            </button>

            <!-- Sub-items (render when expanded) -->
            @if (item.subItems && expandedGroup() === item.id) {
            <div class="pl-6 mt-2 space-y-1">
                @for (sub of item.subItems; track sub.id) {
                <button (click)="setTab(sub.id)" [class.bg-cyan-400]="currentTab() === sub.id"
                    class="w-full flex items-center space-x-3 px-3 py-2 rounded-lg text-sm text-gray-300 hover:text-slate-900 hover:bg-slate-700 transition">
                    <svg class="w-4 h-4 flex-shrink-0 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="sub.icon || 'M5 12h14'" />
                    </svg>
                    @if (!sidebarCollapsed()) {
                    <span class="flex-1 text-left">{{ sub.label }}</span>
                    }
                </button>
                }
            </div>
            }

            }

        </nav>

        <!-- User Section -->
        <div class="border-t border-slate-700 p-4">
            @if (!sidebarCollapsed()) {
            <div class="flex items-center space-x-3 mb-3">
                <div
                    class="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center font-bold text-slate-900">
                    AD
                </div>
                <div class="flex-1">
                    <p class="text-sm font-semibold">{{ userInfo?.username }}</p>
                    <p class="text-xs text-gray-400">{{ userInfo?.email }}</p>
                </div>
            </div>

            <button (click)="logout()"
                class="w-full flex items-center space-x-2 px-4 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
                <span class="font-semibold">Cerrar sesión</span>
            </button>
            } @else {
            <button (click)="logout()"
                class="w-full flex items-center justify-center p-3 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition-colors group relative">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>

                <div
                    class="absolute left-full ml-6 px-3 py-2 bg-slate-800 text-white text-sm rounded-lg shadow-xl opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity whitespace-nowrap z-50">
                    Cerrar sesión
                </div>
            </button>
            }
        </div>

        <!-- Toggle Button -->
        <button (click)="toggleSidebar()"
            class="absolute -right-3 top-20 bg-cyan-400 text-slate-900 p-1.5 rounded-full shadow-lg hover:bg-cyan-500 transition-colors z-50">
            <svg class="w-4 h-4 transition-transform" [class.rotate-180]="sidebarCollapsed()" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
        </button>
    </aside>

    <!-- Main Content Area -->
    <main class="flex-1 flex flex-col overflow-hidden min-w-0">

        <!-- Top Header Bar -->
        <header class="bg-white shadow-md px-8 py-4 flex items-center justify-between flex-shrink-0">
            <div>
                <h2 class="text-2xl font-bold text-slate-900">
                    {{ getCurrentTitle() }}
                </h2>
                <p class="text-sm text-gray-600">{{ getCurrentDescription() }}</p>
            </div>

            <div class="flex items-center space-x-4">
                <!-- Stats Cards -->
                <!--      <app-stats-card icon="bell" label="Pendientes" [value]="pendingCount()" color="red">
                </app-stats-card>

                <app-stats-card icon="dollar" label="Ingresos" value="€45.2K" color="green">
                </app-stats-card> -->
            </div>
        </header>

        <!-- Content Area with Scroll -->
        <div class="flex-1 overflow-y-auto bg-gradient-to-br from-gray-50 to-cyan-50 p-8">
            <div class="animate-fadeIn">
                @switch (currentTab()) {
                @case ('projects') {
                <app-projects-grid />
                }
                @case ('services') {
                <app-services-list />
                }
                @case ('quotes') {
                <app-quotes-list />
                }
                @case ('documents') {
                <app-documents-list />
                }
                @case ('budgets') {
                <app-budget />
                }
                @case ('invoice') {
                <app-invoice-creator />
                }
                @case ('admins') {
                <app-admins-list />
                }
                @case ('accounting') {
                <div class="text-sm text-gray-500">Selecciona una opción de Contabilidad en el sidebar.</div>
                }
                }
            </div>
        </div>
    </main>
</div>